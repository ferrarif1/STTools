<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%F0%9F%9B%A1%EF%B8%8F-security-check-%E6%9C%8D%E5%8A%A1%E5%99%A8---%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E5%AE%8C%E6%95%B4%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">🛡️ Security Check 服务器 - 内网环境完整解决方案</h1>
<blockquote>
<p>专为内网环境设计的Security Check日志收集服务器，支持离线安装、任务计划程序部署和自动重启监控</p>
</blockquote>
<p><a href="https://www.python.org/"><img src="https://img.shields.io/badge/python-3.7+-blue.svg" alt="Python"></a>
<a href="https://www.microsoft.com/windows/"><img src="https://img.shields.io/badge/Windows-7+-green.svg" alt="Windows"></a>
<a href="LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"></a></p>
<h2 id="%F0%9F%93%8B-%E7%9B%AE%E5%BD%95">📋 目录</h2>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">项目概述</a></li>
<li><a href="#%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7">功能特性</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">文件结构</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a></li>
<li><a href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85">离线安装</a></li>
<li><a href="#%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8">详细使用</a></li>
<li><a href="#%E7%9B%91%E6%8E%A7%E5%92%8C%E7%BB%B4%E6%8A%A4">监控和维护</a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">技术架构</a></li>
</ul>
<h2 id="%F0%9F%8E%AF-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">🎯 项目概述</h2>
<p>Security Check基线检查工具的服务端，采用任务计划程序方案，支持离线安装，无需任何外部依赖，确保在内网环境中稳定运行。</p>
<h3 id="%E2%9C%A8-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7">✨ 主要特性</h3>
<ul>
<li>🖥️ <strong>系统集成</strong> - 使用Windows自带任务计划程序</li>
<li>🔄 <strong>自动重启</strong> - 掉线时自动重启，确保高可用性</li>
<li>📊 <strong>健康监控</strong> - 实时健康检查和状态监控</li>
<li>📝 <strong>详细日志</strong> - 完整的操作日志和错误记录</li>
<li>🚀 <strong>开机自启</strong> - 系统启动时自动运行</li>
<li>🛡️ <strong>权限管理</strong> - 支持SYSTEM权限运行</li>
<li>📦 <strong>离线安装</strong> - 支持完全离线环境部署</li>
<li>🔧 <strong>便捷管理</strong> - 提供批处理脚本简化操作</li>
</ul>
<h2 id="%F0%9F%93%81-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">📁 文件结构</h2>
<pre class="hljs"><code><div>server/
├── README.md                             # 完整技术文档
├── server_enhanced.py                    # 增强版服务器（核心）
├── install_task_scheduler_simple.py      # 任务计划安装脚本
├── auto_restart_monitor.py               # 自动重启监控器
├── download_packages.py                  # 包下载脚本（有网络时使用）
├── install_dependencies.py               # 离线安装脚本
├── packages/                             # 离线包目录
│   ├── requests-2.32.5-py3-none-any.whl
│   ├── pandas-2.2.3-cp311-cp311-win_amd64.whl
│   ├── chardet-5.2.0-py3-none-any.whl
│   ├── openpyxl-3.1.5-py2.py3-none-any.whl
│   └── ... (其他依赖包)
├── scripts/                              # 批处理脚本目录
│   ├── quick_start.bat                   # 快速启动脚本
│   ├── start_task.bat                    # 启动任务脚本
│   ├── stop_task.bat                     # 停止任务脚本
│   ├── restart_task.bat                  # 重启任务脚本
│   └── check_task_status.bat             # 检查状态脚本
├── logs/                                 # 日志目录（运行时生成）
│   ├── server_*.log                      # 服务器日志
│   ├── task_scheduler_simple_*.log       # 任务安装日志
│   └── auto_restart_*.log                # 监控器日志
└── Monitor/                              # 监控数据目录（运行时生成）
    ├── summary.xlsx                      # 汇总数据
    └── *.txt                             # 各IP的日志文件
</div></code></pre>
<h2 id="%F0%9F%9A%80-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">🚀 快速开始</h2>
<h3 id="%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82">环境要求</h3>
<ul>
<li><strong>操作系统</strong>: Windows 7/8/10/11</li>
<li><strong>Python</strong>: 3.7+</li>
<li><strong>权限</strong>: 管理员权限（用于安装任务计划）</li>
</ul>
<h3 id="%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4">安装步骤</h3>
<h4 id="1-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85">1. 离线安装依赖包</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 运行离线安装脚本</span>
python install_dependencies.py
</div></code></pre>
<h4 id="2-%E5%AE%89%E8%A3%85%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92">2. 安装任务计划</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 以管理员身份运行命令提示符</span>
python install_task_scheduler_simple.py install
</div></code></pre>
<h4 id="3-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8">3. 启动服务器</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 使用批处理脚本快速启动</span>
scripts\quick_start.bat

<span class="hljs-comment"># 或者手动启动</span>
python install_task_scheduler_simple.py start
</div></code></pre>
<h4 id="4-%E5%90%AF%E5%8A%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%9B%91%E6%8E%A7">4. 启动自动重启监控</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 启动自动重启监控器</span>
python auto_restart_monitor.py
</div></code></pre>
<h2 id="%F0%9F%93%A6-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85">📦 离线安装</h2>
<h3 id="%E5%8C%85%E4%B8%8B%E8%BD%BD%E5%9C%A8%E6%9C%89%E7%BD%91%E7%BB%9C%E7%9A%84%E7%8E%AF%E5%A2%83%E4%B8%AD">包下载（在有网络的环境中）</h3>
<p>如果您需要更新依赖包，可以在有网络的环境中运行：</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 下载最新的依赖包</span>
python download_packages.py
</div></code></pre>
<p>这将下载以下包到 <code>packages/</code> 目录：</p>
<ul>
<li><strong>requests</strong> - HTTP请求库</li>
<li><strong>pandas</strong> - 数据处理库</li>
<li><strong>chardet</strong> - 编码检测库</li>
<li><strong>openpyxl</strong> - Excel文件处理库</li>
<li><strong>numpy</strong> - 数值计算库（pandas依赖）</li>
<li><strong>其他依赖包</strong></li>
</ul>
<h3 id="%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%9C%A8%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E4%B8%AD">离线安装（在内网环境中）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 运行离线安装脚本</span>
python install_dependencies.py
</div></code></pre>
<p>脚本会自动：</p>
<ul>
<li>检查Python版本</li>
<li>检查已安装的包</li>
<li>从 <code>packages/</code> 目录安装缺失的包</li>
<li>验证安装结果</li>
</ul>
<h2 id="%F0%9F%9B%A0%EF%B8%8F-%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8">🛠️ 详细使用</h2>
<h3 id="%E6%89%B9%E5%A4%84%E7%90%86%E8%84%9A%E6%9C%AC%E7%AE%A1%E7%90%86">批处理脚本管理</h3>
<p>我们提供了便捷的批处理脚本，简化日常操作：</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 快速启动（推荐）</span>
scripts\quick_start.bat

<span class="hljs-comment"># 启动任务</span>
scripts\start_task.bat

<span class="hljs-comment"># 停止任务</span>
scripts\stop_task.bat

<span class="hljs-comment"># 重启任务</span>
scripts\restart_task.bat

<span class="hljs-comment"># 检查状态</span>
scripts\check_task_status.bat
</div></code></pre>
<h3 id="python%E8%84%9A%E6%9C%AC%E7%AE%A1%E7%90%86">Python脚本管理</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 安装任务计划</span>
python install_task_scheduler_simple.py install

<span class="hljs-comment"># 启动任务</span>
python install_task_scheduler_simple.py start

<span class="hljs-comment"># 停止任务</span>
python install_task_scheduler_simple.py stop

<span class="hljs-comment"># 重启任务</span>
python install_task_scheduler_simple.py restart

<span class="hljs-comment"># 检查状态</span>
python install_task_scheduler_simple.py status

<span class="hljs-comment"># 卸载任务</span>
python install_task_scheduler_simple.py uninstall
</div></code></pre>
<h3 id="%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%9F%E8%83%BD">服务器功能</h3>
<h4 id="%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E7%AB%AF%E7%82%B9">健康检查端点</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查服务器健康状态</span>
curl http://localhost:8000/health

<span class="hljs-comment"># 查看详细状态信息</span>
curl http://localhost:8000/status
</div></code></pre>
<h4 id="%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E7%AB%AF%E7%82%B9">日志收集端点</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 发送日志数据</span>
curl -X POST http://localhost:8000/<span class="hljs-built_in">log</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"message": "test log", "level": "info"}'</span>
</div></code></pre>
<h4 id="%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E7%AB%AF%E7%82%B9">文件下载端点</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 下载Security Check工具</span>
curl -O http://localhost:8000/SecurityCheck_v5

<span class="hljs-comment"># 下载MSU补丁</span>
curl -O http://localhost:8000/msu
</div></code></pre>
<h2 id="%F0%9F%94%84-%E7%9B%91%E6%8E%A7%E5%92%8C%E7%BB%B4%E6%8A%A4">🔄 监控和维护</h2>
<h3 id="%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%9B%91%E6%8E%A7">自动重启监控</h3>
<p>自动重启监控器提供以下功能：</p>
<ul>
<li><strong>定期检查</strong> - 每30秒检查一次服务器状态</li>
<li><strong>自动重启</strong> - 掉线时自动重启任务计划</li>
<li><strong>重试机制</strong> - 最多重试3次，避免无限重启</li>
<li><strong>日志记录</strong> - 详细记录所有操作</li>
</ul>
<h4 id="%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0">配置参数</h4>
<p>可以在 <code>auto_restart_monitor.py</code> 中修改：</p>
<pre class="hljs"><code><div>CHECK_INTERVAL = <span class="hljs-number">30</span>      <span class="hljs-comment"># 检查间隔（秒）</span>
MAX_RESTART_ATTEMPTS = <span class="hljs-number">3</span> <span class="hljs-comment"># 最大重启尝试次数</span>
</div></code></pre>
<h3 id="%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86">日志管理</h3>
<h4 id="%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97">查看日志</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 查看服务器日志</span>
<span class="hljs-built_in">type</span> logs\server_*.<span class="hljs-built_in">log</span>

<span class="hljs-comment"># 查看任务安装日志</span>
<span class="hljs-built_in">type</span> logs\task_scheduler_simple_*.<span class="hljs-built_in">log</span>

<span class="hljs-comment"># 查看监控器日志</span>
<span class="hljs-built_in">type</span> logs\auto_restart_*.<span class="hljs-built_in">log</span>
</div></code></pre>
<h4 id="%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC">日志轮转</h4>
<p>建议定期清理旧日志文件：</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 清理7天前的日志</span>
forfiles /p logs /s /m *.<span class="hljs-built_in">log</span> /d -7 /c <span class="hljs-string">"cmd /c del @path"</span>
</div></code></pre>
<h2 id="%F0%9F%94%8D-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">🔍 故障排除</h2>
<h3 id="%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</h3>
<h4 id="1-%E4%BE%9D%E8%B5%96%E5%8C%85%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5">1. 依赖包安装失败</h4>
<p><strong>问题</strong>: 提示缺少pandas、requests等包
<strong>解决</strong>: 运行离线安装脚本</p>
<pre class="hljs"><code><div>python install_dependencies.py
</div></code></pre>
<h4 id="2-%E4%BB%BB%E5%8A%A1%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5">2. 任务安装失败</h4>
<p><strong>问题</strong>: 提示需要管理员权限
<strong>解决</strong>: 以管理员身份运行命令提示符</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查管理员权限</span>
net session
</div></code></pre>
<h4 id="3-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE">3. 服务器无法访问</h4>
<p><strong>问题</strong>: 无法访问 http://localhost:8000
<strong>解决</strong>: 检查端口占用和防火墙设置</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查端口占用</span>
netstat -ano | findstr :8000

<span class="hljs-comment"># 检查防火墙</span>
netsh advfirewall firewall show rule name=all | findstr 8000
</div></code></pre>
<h4 id="4-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E4%B8%8D%E5%B7%A5%E4%BD%9C">4. 自动重启不工作</h4>
<p><strong>问题</strong>: 监控器无法重启服务器
<strong>解决</strong>: 检查任务计划状态</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 检查任务状态</span>
scripts\check_task_status.bat

<span class="hljs-comment"># 手动重启任务</span>
scripts\restart_task.bat
</div></code></pre>
<h4 id="5-excel%E5%86%99%E5%85%A5%E5%A4%B1%E8%B4%A5">5. Excel写入失败</h4>
<p><strong>问题</strong>: 日志数据没有写入Excel文件
<strong>解决</strong>: 检查依赖包和权限</p>
<pre class="hljs"><code><div><span class="hljs-comment"># 重新安装依赖包</span>
python install_dependencies.py

<span class="hljs-comment"># 检查Monitor目录权限</span>
dir Monitor
</div></code></pre>
<h3 id="%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">性能优化</h3>
<h4 id="%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96">内存优化</h4>
<ul>
<li>服务器内存占用约50-100MB</li>
<li>监控器内存占用约20-30MB</li>
<li>建议定期重启释放内存</li>
</ul>
<h4 id="%E7%A3%81%E7%9B%98%E4%BC%98%E5%8C%96">磁盘优化</h4>
<ul>
<li>定期清理日志文件</li>
<li>监控Excel文件大小</li>
<li>建议设置日志轮转</li>
</ul>
<h2 id="%F0%9F%8F%97%EF%B8%8F-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">🏗️ 技术架构</h2>
<h3 id="%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84">系统架构</h3>
<pre class="hljs"><code><div>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   客户端应用    │    │   Security      │    │   任务计划      │
│                │───▶│   Check工具     │───▶│   程序          │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   增强版服务器  │    │   自动重启      │
                       │   server_enhanced│    │   监控器        │
                       └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   日志存储      │    │   健康检查      │
                       │   Monitor/      │    │   /health       │
                       └─────────────────┘    └─────────────────┘
</div></code></pre>
<h3 id="%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">核心组件</h3>
<h4 id="1-%E5%A2%9E%E5%BC%BA%E7%89%88%E6%9C%8D%E5%8A%A1%E5%99%A8-serverenhancedpy">1. 增强版服务器 (<code>server_enhanced.py</code>)</h4>
<ul>
<li><strong>HTTP服务器</strong> - 基于Python内置http.server</li>
<li><strong>健康检查</strong> - <code>/health</code> 和 <code>/status</code> 端点</li>
<li><strong>日志收集</strong> - <code>/log</code> 端点接收客户端数据</li>
<li><strong>文件服务</strong> - 提供工具和补丁下载</li>
<li><strong>Excel写入</strong> - 支持并发安全的Excel数据写入</li>
<li><strong>错误处理</strong> - 完善的异常处理和日志记录</li>
</ul>
<h4 id="2-%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E5%AE%89%E8%A3%85%E5%99%A8-installtaskschedulersimplepy">2. 任务计划安装器 (<code>install_task_scheduler_simple.py</code>)</h4>
<ul>
<li><strong>任务创建</strong> - 使用schtasks创建系统任务</li>
<li><strong>权限管理</strong> - 设置SYSTEM权限运行</li>
<li><strong>开机自启</strong> - 配置系统启动时运行</li>
<li><strong>状态管理</strong> - 启动、停止、重启任务</li>
<li><strong>批处理生成</strong> - 自动生成管理脚本</li>
</ul>
<h4 id="3-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%9B%91%E6%8E%A7%E5%99%A8-autorestartmonitorpy">3. 自动重启监控器 (<code>auto_restart_monitor.py</code>)</h4>
<ul>
<li><strong>健康检查</strong> - 定期检查服务器状态</li>
<li><strong>自动重启</strong> - 掉线时自动重启任务</li>
<li><strong>重试机制</strong> - 限制重启次数避免无限循环</li>
<li><strong>日志记录</strong> - 详细记录监控活动</li>
</ul>
<h4 id="4-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7">4. 离线安装工具</h4>
<ul>
<li><strong>包下载器</strong> (<code>download_packages.py</code>) - 在有网络环境下载依赖包</li>
<li><strong>离线安装器</strong> (<code>install_dependencies.py</code>) - 在内网环境安装依赖包</li>
</ul>
<h3 id="%E6%95%B0%E6%8D%AE%E6%B5%81">数据流</h3>
<pre class="hljs"><code><div>客户端 → 服务器 → 日志文件 → Excel汇总
   ↓         ↓         ↓
健康检查 ← 监控器 ← 状态检查
</div></code></pre>
<h2 id="%F0%9F%93%8A-%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87">📊 监控指标</h2>
<h3 id="%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E6%A0%87">服务器指标</h3>
<ul>
<li><strong>运行时间</strong> - 服务器启动后的运行时长</li>
<li><strong>请求数量</strong> - 接收到的HTTP请求数量</li>
<li><strong>错误率</strong> - 错误请求占总请求的比例</li>
<li><strong>响应时间</strong> - 平均响应时间</li>
</ul>
<h3 id="%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87">系统指标</h3>
<ul>
<li><strong>内存使用</strong> - 服务器进程内存占用</li>
<li><strong>CPU使用</strong> - 服务器进程CPU使用率</li>
<li><strong>磁盘空间</strong> - 日志文件占用空间</li>
<li><strong>网络连接</strong> - 活跃连接数量</li>
</ul>
<h2 id="%F0%9F%94%92-%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91">🔒 安全考虑</h2>
<h3 id="%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6">访问控制</h3>
<ul>
<li>服务器监听所有网络接口 (0.0.0.0:8000)</li>
<li>建议配置防火墙限制访问IP</li>
<li>可以添加认证机制增强安全性</li>
</ul>
<h3 id="%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4">数据保护</h3>
<ul>
<li>日志数据存储在本地</li>
<li>建议定期备份重要数据</li>
<li>可以加密敏感日志信息</li>
</ul>
<h2 id="%F0%9F%93%88-%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD">📈 扩展功能</h2>
<h3 id="%E5%8F%AF%E8%83%BD%E7%9A%84%E6%89%A9%E5%B1%95">可能的扩展</h3>
<ol>
<li><strong>Web管理界面</strong> - 提供Web界面管理服务器</li>
<li><strong>数据库存储</strong> - 使用数据库替代文件存储</li>
<li><strong>集群部署</strong> - 支持多服务器集群</li>
<li><strong>API接口</strong> - 提供RESTful API接口</li>
<li><strong>告警通知</strong> - 支持邮件、短信告警</li>
</ol>
<h2 id="%F0%9F%93%9E-%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81">📞 技术支持</h2>
<h3 id="%E8%8E%B7%E5%8F%96%E5%B8%AE%E5%8A%A9">获取帮助</h3>
<ol>
<li><strong>查看日志</strong> - 检查 <code>logs/</code> 目录下的日志文件</li>
<li><strong>健康检查</strong> - 访问 <code>/health</code> 端点检查状态</li>
<li><strong>重启服务</strong> - 使用重启命令恢复服务</li>
<li><strong>查看文档</strong> - 参考本README文档</li>
</ol>
<h3 id="%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C">常见操作</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 完整重启流程</span>
scripts\stop_task.bat
scripts\start_task.bat
python auto_restart_monitor.py

<span class="hljs-comment"># 检查所有状态</span>
scripts\check_task_status.bat
curl http://localhost:8000/health
</div></code></pre>
<h3 id="%E4%BE%9D%E8%B5%96%E5%8C%85%E4%BF%A1%E6%81%AF">依赖包信息</h3>
<p>当前版本包含的依赖包：</p>
<ul>
<li><strong>requests</strong> 2.32.5 - HTTP请求库</li>
<li><strong>pandas</strong> 2.2.3 - 数据处理库</li>
<li><strong>chardet</strong> 5.2.0 - 编码检测库</li>
<li><strong>openpyxl</strong> 3.1.5 - Excel文件处理库</li>
<li><strong>numpy</strong> 2.2.4 - 数值计算库</li>
<li><strong>其他依赖包</strong> - 详见packages目录</li>
</ul>
<hr>
<p>⭐ <strong>Security Check 服务器 - 内网环境的最佳选择！</strong></p>
<blockquote>
<p>简单、可靠、支持离线安装，专为内网环境设计的高可用日志收集服务器。</p>
</blockquote>

</body>
</html>
