
### **README - Windows 补丁自动化安装工具**

#### **📌 程序打包说明**
本安装程序由 `installer.py` 打包生成，采用自动化封装技术实现以下特性：
- **智能版本匹配**：自动检测 Windows 系统版本（7/8/10/11/Server）
- **静默安装模式**：无界面后台自动安装
- **依赖检测**：自动跳过不兼容系统的补丁



## **🚀 快速开始**

### **1️⃣ 文件准备**
1. 将生成的 `installer.exe` 放置在 `patches/` 目录顶层，即与patches并列  
2. 按规范组织补丁文件：
```
patches/
├── KB5017858/          # 补丁文件夹（必须KB开头）
│   ├── Windows10-x64.msu  # 包含系统版本标识
│   └── Windows11-x64.msu
├── KB5034765/
│   └── Server2019.msu
installer.exe       # 主程序位置
```

### **2️⃣ 执行安装**
1. **右键管理员身份运行**：
   ```powershell
   # 在 patches 目录右键选择 "以管理员身份运行"
   .\installer.exe
   ```
2. 程序将自动执行：
   - ✅ 扫描所有 KB 子文件夹
   - ✅ 匹配当前系统版本（基于文件名识别）
   - ✅ 按顺序静默安装适用补丁

### **3️⃣ 实时输出示例**
```log
正在检查 KB5017858 补丁...
找到匹配补丁：Windows10-x64.msu
正在安装：patches\KB5017858\Windows10-x64.msu ...
安装成功：patches\KB5017858\Windows10-x64.msu

正在检查 KB5034765 补丁...
未找到适用于当前系统的补丁，跳过。
```

---

## **⚙️ 文件命名规范**
为确保正确识别，补丁文件命名需包含以下系统标识符：

| 系统版本       | 文件名必须包含关键词      |
|----------------|-------------------------|
| Windows 7      | `Windows7` 或 `Win7`    |
| Windows 10     | `Windows10` 或 `Win10`  |
| Windows 11     | `Windows11` 或 `Win11`  |
| Server 系列    | `Server` + 年份         |

**正确示例**：  
`KB5017858_Windows10-22H2-x64.msu`  
`SecurityUpdate_Server2019.msu`

---

## **📌 注意事项**
1. **管理员权限**  
   必须右键选择 **"以管理员身份运行"**，否则会出现权限错误：
   ```log
   [错误] 无法访问系统更新服务（错误代码 0x80070005）
   ```

2. **系统兼容性检测**  
   程序通过以下方式识别系统版本：
   ```python
   # 核心检测逻辑（基于platform模块）
   platform.release()  # 返回 10/8/7 等主版本号
   platform.version()  # 返回详细版本号（如 10.0.19045）
   ```

3. **安装顺序控制**  
   建议按补丁发布日期排序文件夹：
   ```
   patches/
   ├── KB1234567/  # 旧补丁
   └── KB9876543/  # 新补丁
   ```

---

## **🛠️ 技术支持**
遇到问题时请按以下步骤排查：

### **1️⃣ 补丁未识别**
```log
未找到适用于当前系统的 KB5034765 补丁
```
✅ 解决方案：
1. 检查文件名是否包含系统版本关键词
2. 确认系统版本与补丁兼容性
3. 尝试在文件名中添加版本号（如 `Win10-22H2`）

### **2️⃣ 安装失败**
```log
安装失败：patches\KB5017858\Windows10-x64.msu
```
✅ 解决方案：
1. 手动运行安装命令验证：
   ```cmd
   wusa.exe "patches\KB5017858\Windows10-x64.msu" /quiet /norestart
   ```
2. 检查系统更新历史记录中的错误代码

### **3️⃣ 系统版本误判**
```log
当前系统版本：10.0.19045
```
✅ 验证方法：
1. 运行 `winver` 命令查看实际版本
2. 对比补丁文件支持的版本范围

---

